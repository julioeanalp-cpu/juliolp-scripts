document.addEventListener('DOMContentLoaded', function () { console.log('üîç Iniciando sistema de favoritos...'); const grid = document.getElementById('wishlist-grid'); const emptyBox = document.getElementById('wishlist-empty'); if (!grid) { console.error('‚ùå Elemento #wishlist-grid n√£o encontrado'); return; } const possibleKeys = [ 'wishlist', 'favorites', 'favourites', 'savedItems', 'likedProducts', 'savedProducts', 'heart', 'wish', 'saved', 'juliolp_favorites', 'juliolp_wishlist' ]; let wishlist = []; let usedKey = 'wishlist'; for (const key of possibleKeys) { try { const data = localStorage.getItem(key); if (data && data !== 'null' && data !== '[]') { const parsed = JSON.parse(data); if (Array.isArray(parsed) && parsed.length > 0) { wishlist = parsed; usedKey = key; console.log(`‚úÖ Favoritos encontrados em: ${key}`, parsed); break; } } } catch (e) { console.warn(`‚ö†Ô∏è Erro ao ler ${key}:`, e); } } if (wishlist.length === 0) { console.log('üîç Procurando em TODAS as chaves do localStorage...'); for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); try { const data = localStorage.getItem(key); const parsed = JSON.parse(data); if (Array.isArray(parsed) && parsed.length > 0) { const first = parsed[0]; if (first && (first.title || first.name || first.price || first.image || first.url)) { wishlist = parsed; usedKey = key; console.log(`‚úÖ Favoritos detectados em: ${key}`, parsed); break; } } } catch (e) { } } } console.log(`üìä Total de favoritos: ${wishlist.length}`); if (wishlist.length === 0) { console.log('‚ÑπÔ∏è Nenhum favorito encontrado'); emptyBox.style.display = 'block'; grid.style.display = 'none'; console.log('üì¶ Todas as chaves do localStorage:'); for (let i = 0; i < localStorage.length; i++) { console.log(` - ${localStorage.key(i)}`); } return; } emptyBox.style.display = 'none'; grid.style.display = 'grid'; grid.innerHTML = wishlist.map((item, index) => { const productUrl = item.url || item.link || item.href || item.productUrl || item.pageUrl || '#'; const productImage = item.image || item.img || item.thumbnail || item.picture || item.photo || 'https: const productTitle = item.title || item.name || item.productName || 'Produto sem t√≠tulo'; let productPrice = item.price || item.preco || item.valor || '0.00'; if (typeof productPrice === 'string') { productPrice = productPrice.replace('‚Ç¨', '').replace(',', '.').trim(); } console.log(`‚úÖ Renderizando produto ${index + 1}:`, { title: productTitle, price: productPrice, image: productImage, url: productUrl }); return ` <article class="product-card" data-url="${productUrl}" data-index="${index}"> <div class="product-image"> <img class="product-thumb" src="${productImage}" alt="${productTitle}" onerror="this.onerror=null; this.src='https: <button class="btn-remove-page" title="Remover dos favoritos"> <i class="fas fa-times"></i> </button> </div> <div class="product-info"> <div class="product-title">${productTitle}</div> <div class="product-price">‚Ç¨${productPrice}</div> <button class="btn-add-cart-wish"> Adicionar ao carrinho </button> </div> </article> `; }).join(''); console.log('‚úÖ Produtos renderizados com sucesso!'); grid.addEventListener('click', function (e) { if (e.target.closest('.btn-remove-page')) { const card = e.target.closest('.product-card'); const index = parseInt(card.dataset.index); const url = card.dataset.url; console.log(`üóëÔ∏è Removendo produto ${index}:`, wishlist[index]); wishlist.splice(index, 1); localStorage.setItem(usedKey, JSON.stringify(wishlist)); console.log(`üíæ Favoritos atualizados (${wishlist.length} restantes)`); card.remove(); if (typeof updateWishlistCount === 'function') { updateWishlistCount(); } if (wishlist.length === 0) { emptyBox.style.display = 'block'; grid.style.display = 'none'; console.log('‚ÑπÔ∏è Lista de favoritos ficou vazia'); } } if (e.target.closest('.btn-add-cart-wish')) { const card = e.target.closest('.product-card'); const url = card.dataset.url; console.log('üõí Adicionando ao carrinho:', url); if (typeof addToCart === 'function') { addToCart({ dataset: { url } }); if (typeof openCart === 'function') { openCart(); } console.log('‚úÖ Produto adicionado ao carrinho'); } else { if (url && url !== '#') { window.location.href = url; } else { alert('N√£o foi poss√≠vel adicionar ao carrinho. Por favor, clique no produto para ver detalhes.'); } } } }); console.log('‚úÖ Sistema de favoritos totalmente carregado!'); });
