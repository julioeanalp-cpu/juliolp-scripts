// Vers√£o 2.0 - Corrigida para compatibilidade com simpleCart.js
!function(){"use strict";const e={whatsappNumber:"351919225483",checkoutPageUrl:"/p/checkout.html",cartStorageKey:"vinylCartComplete",wishlistStorageKey:"vinylWishlist"};function t(){try{const t=localStorage.getItem(e.cartStorageKey);return t?JSON.parse(t):{items:[],total:0,count:0}}catch(t){return console.error("Erro ao carregar dados do carrinho:",t),{items:[],total:0,count:0}}}function a(t){try{localStorage.setItem(e.cartStorageKey,JSON.stringify(t))}catch(t){console.error("Erro ao salvar dados do carrinho:",t)}}function n(){const e=document.getElementById("cartCount"),t=document.getElementById("cartItems"),a=document.getElementById("cartFooter"),n=document.getElementById("cartSubtotal");if(e&&(e.textContent=window.cartData.count,e.style.display=window.cartData.count>0?"flex":"none"),0===window.cartData.items.length)return a&&(a.style.display="none"),void(t&&(t.innerHTML='<div class="cart-empty"><i class="fas fa-shopping-cart"></i><p>Seu carrinho est√° vazio</p></div>'));a&&(a.style.display="block");let o="";window.cartData.items.forEach((e=>{o+=`\n                <div class="cart-item">\n                    <div class="cart-item-image"><img src="${e.image}" alt="${e.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/80x80/d4af37/1a1a1a?text=Vinil'"></div>\n                    <div class="cart-item-details">\n                        <div class="cart-item-title">${e.title}</div>\n                        <div class="cart-item-artist">${e.artist}</div>\n                        <div class="cart-item-price">‚Ç¨${e.price.toFixed(2 )}</div>\n                        <div class="cart-item-quantity">\n                            <button onclick="updateQuantity(${e.id}, -1)" class="qty-btn">‚àí</button>\n                            <span>${e.quantity}</span>\n                            <button onclick="updateQuantity(${e.id}, 1)" class="qty-btn">+</button>\n                        </div>\n                    </div>\n                    <button class="cart-item-remove" onclick="removeFromCart(${e.id})"><i class="fas fa-trash"></i></button>\n                </div>`})),t&&(t.innerHTML=o),n&&(n.textContent="‚Ç¨"+window.cartData.total.toFixed(2))}function o(){window.cartData.count=0,window.cartData.total=0,window.cartData.items.forEach((e=>{window.cartData.count+=e.quantity,window.cartData.total+=e.price*e.quantity})),a(window.cartData),n()}function i(){try{const t=localStorage.getItem(e.wishlistStorageKey);t&&(window.wishlist=JSON.parse(t))}catch(t){console.error("Erro ao carregar favoritos:",t),window.wishlist=[]}}function s(){try{localStorage.setItem(e.wishlistStorageKey,JSON.stringify(window.wishlist))}catch(e){console.error("Erro ao salvar favoritos:",e)}}function r(e){const t=parseFloat(e);return isNaN(t)?"0.00":t.toFixed(2)}function l(){const e=document.getElementById("wishlistCount");e&&(e.textContent=window.wishlist.length,e.style.display=window.wishlist.length>0?"flex":"none")}function d(){document.querySelectorAll(".btn-wishlist, .product-wishlist-btn").forEach((e=>{const t=e.closest(".product-card"),a=t?t.querySelector(".product-title a"):document.querySelector(".product-info-area h1, h1");if(a){const t=a.textContent.trim().replace(/\s+/g,"-").toLowerCase(),n=window.wishlist.some((e=>e.id===t));n?(e.classList.add("active"),e.innerHTML='<i class="fas fa-heart"></i>'):(e.classList.remove("active"),e.innerHTML='<i class="far fa-heart"></i>')}}))}window.cartData=t(),window.wishlist=[],window.addToCart=function(e){const t=e.closest(".product-card");if(!t)return;const a=t.querySelector(".product-title"),n=t.querySelector(".product-price");if(!a||!n)return;const i=a.textContent.trim(),s=parseFloat(n.getAttribute("data-price"))||15,r=window.cartData.items.find((e=>e.title===i));r?r.quantity++:window.cartData.items.push({id:Date.now(),title:i,artist:t.querySelector(".product-artist")?.textContent.trim()||"Artista",price:s,quantity:1,image:t.querySelector(".product-thumb")?.src||"",url:e.getAttribute("data-url")||"#"}),o()},window.addToCartSingle=function(e){const t=e.closest(".product-single-container");if(!t)return!1;const a=t.querySelector(".product-info-area h1"),n=t.querySelector(".product-price-value");if(!a||!n)return!1;const i=a.textContent.trim().replace(/\s+/g," "),s=parseFloat(n.getAttribute("data-price"))||15,r=window.cartData.items.find((e=>e.title===i));return r||window.cartData.items.push({id:Date.now(),title:i,artist:t.querySelector(".product-artist")?.textContent.trim()||"Artista",price:s,quantity:1,image:t.querySelector(".product-main-image img")?.src||"",url:window.location.href}),o(),!0},window.removeFromCart=function(e){window.cartData.items=window.cartData.items.filter((t=>t.id!==e)),o()},window.updateQuantity=function(e,t){const a=window.cartData.items.find((t=>t.id===e));a&&(a.quantity+=t,a.quantity<=0?window.removeFromCart(e):o())},window.toggleCart=function(){document.getElementById("cartSidebar")?.classList.toggle("active"),document.getElementById("cartOverlay")?.classList.toggle("active")},window.openCart=function(){const e=document.getElementById("cartSidebar"),t=document.getElementById("cartOverlay");e&&t&&(e.classList.add("active"),t.classList.add("active"),document.body.style.overflow="hidden")},window.closeCart=function(){const e=document.getElementById("cartSidebar"),t=document.getElementById("cartOverlay");e&&t&&(e.classList.remove("active"),t.classList.remove("active"),document.body.style.overflow="")},window.goToCheckout=function(){0===window.cartData.items.length?alert("Seu carrinho est√° vazio!"):(a(window.cartData),window.location.href=e.checkoutPageUrl)},window.buyNowAndCheckout=function(){window.addToCartSingle(document.getElementById("addToCartBtn"))?window.goToCheckout():alert("Ocorreu um erro ao adicionar o produto. Tente novamente.")},window.checkoutWhatsApp=function(){if(0===window.cartData.items.length)return alert("Seu carrinho est√° vazio!");let t="üéµ Ol√°! Gostaria de encomendar os seguintes discos:\n\n";window.cartData.items.forEach((e=>{t+=`*${e.title}*\n`,t+=`Quantidade: ${e.quantity}\n`,t+=`Pre√ßo: ‚Ç¨${(e.price*e.quantity).toFixed(2)}\n\n`})),t+=`*Total do Pedido: ‚Ç¨${window.cartData.total.toFixed(2)}*`;const a=`https://wa.me/${e.whatsappNumber}?text=${encodeURIComponent(t )}`;window.open(a,"_blank")},window.buyWhatsAppSingleProduct=function(){const t=document.querySelector(".product-single-container");if(!t)return;const a=t.querySelector(".product-info-area h1"),n=t.querySelector(".product-price-value");if(!a||!n)return;const o=a.textContent.trim().replace(/\s+/g," "),i=n.getAttribute("data-price")||"N/A",s=window.location.href;let r=`üéµ Ol√°! Tenho interesse em comprar este disco:\n\n*${o}*\nPre√ßo: ‚Ç¨${i}\n\nLink do produto: ${s}`;const l=`https://wa.me/${e.whatsappNumber}?text=${encodeURIComponent(r )}`;window.open(l,"_blank")},window.updateWishlistUI=function(){const e=document.getElementById("wishlistItems"),t=document.getElementById("wishlistFooter");if(!e)return;if(l(),0===window.wishlist.length)return t&&(t.style.display="none"),void(e.innerHTML='<div class="cart-empty"><i class="fas fa-heart" style="color:#e74c3c;"></i><p>Nenhum favorito ainda</p></div>');t&&(t.style.display="block");let a="";window.wishlist.forEach((function(e,t){const n=e.title||"Produto sem nome",o=e.artist||"Artista",i=r(e.price),l=e.image||"https://via.placeholder.com/80x80/e74c3c/ffffff?text=‚ô•",d=e.url||"#";a+=`<div class="cart-item" style="position:relative;"><div class="cart-item-image"><img src="${l}" alt="${n}" loading="lazy" onerror="this.src='https://via.placeholder.com/80x80/e74c3c/ffffff?text=‚ô•'"></div><div class="cart-item-details" style="flex:1;"><div class="cart-item-title"><a href="${d}" style="color:#1a1a1a;">${n}</a></div><div class="cart-item-artist">${o}</div><div class="cart-item-price">‚Ç¨${i}</div></div><button class="cart-item-remove" onclick="removeFromWishlist(${t} )" style="background:#e74c3c;" title="Remover dos favoritos"><i class="fas fa-trash"></i></button></div>`})),e.innerHTML=a},window.addToWishlist=function(e){const t=e.closest(".product-card");if(!t)return;const a=t.querySelector(".product-title a")||t.querySelector(".product-title"),n=t.querySelector(".product-price");if(!a||!n)return;const o=a.textContent.trim(),i=parseFloat(n.getAttribute("data-price"))||0,r=t.querySelector(".product-thumb")?.src||"",l=a.href||window.location.href,d=o.replace(/\s+/g,"-").toLowerCase(),c=window.wishlist.findIndex((e=>e.id===d));if(c>-1)window.wishlist.splice(c,1),e.classList.remove("active"),e.innerHTML='<i class="far fa-heart"></i>';else{let t=o,a="Artista";o.includes(" - ")&&(parts=o.split(" - "),a=parts[0].trim(),t=parts.slice(1).join(" - ").trim()),window.wishlist.push({id:d,title:t,artist:a,price:i,image:r,url:l}),e.classList.add("active"),e.innerHTML='<i class="fas fa-heart"></i>'}s(),window.updateWishlistUI();const u=document.getElementById("wishlistSidebar"),w=document.getElementById("wishlistOverlay");u&&w&&(u.classList.add("active"),w.classList.add("active"),document.body.style.overflow="hidden")},window.addToWishlistSingle=function(e){const t=e.closest(".product-single-container")||document.querySelector(".product-single-container");if(!t)return;const a=t.querySelector(".product-info-area h1, h1"),n=t.querySelector(".product-price-value"),o=t.querySelector(".product-main-image img");if(!a||!n)return;const i=a.textContent.trim().replace(/\s+/g," "),r=parseFloat(n.getAttribute("data-price"))||0,l=o?o.src:"",d=window.location.href,c=i.replace(/\s+/g,"-").toLowerCase(),u=window.wishlist.findIndex((e=>e.id===c));if(u>-1)window.wishlist.splice(u,1),e.classList.remove("active"),e.innerHTML='<i class="far fa-heart"></i>';else{let t=i,a="Artista";i.includes(" - ")&&(parts=i.split(" - "),a=parts[0].trim(),t=parts.slice(1).join(" - ").trim()),window.wishlist.push({id:c,title:t,artist:a,price:r,image:l,url:d}),e.classList.add("active"),e.innerHTML='<i class="fas fa-heart"></i>'}s(),window.updateWishlistUI();const w=document.getElementById("wishlistSidebar"),m=document.getElementById("wishlistOverlay");w&&m&&(w.classList.add("active"),m.classList.add("active"),document.body.style.overflow="hidden")},window.removeFromWishlist=function(e){e>=0&&e<window.wishlist.length&&(window.wishlist.splice(e,1),s(),l(),window.updateWishlistUI())},window.toggleWishlistSidebar=function(){const e=document.getElementById("wishlistSidebar"),t=document.getElementById("wishlistOverlay");e&&t&&(e.classList.toggle("active"),t.classList.toggle("active"),document.body.style.overflow=e.classList.contains("active")?"hidden":"",window.updateWishlistUI())},window.closeWishlist=function(){const e=document.getElementById("wishlistSidebar"),t=document.getElementById("wishlistOverlay");e&&t&&(e.classList.remove("active"),t.classList.remove("active"),document.body.style.overflow="")},window.viewAllWishlist=function(){"function"==typeof toggleWishlistSidebar&&toggleWishlistSidebar(),window.location.href="/p/favoritos.html"},simpleCart.ready((function(){console.log("‚úÖ simpleCart est√° pronto. Sincronizando com o carrinho local..."),window.cartData.items.forEach((e=>{simpleCart.add({name:e.title,price:e.price,quantity:e.quantity,thumb:e.image,url:e.url})})),console.log("‚úÖ Sincroniza√ß√£o conclu√≠da.")})),simpleCart.bind("afterSave", (function(){console.log("simpleCart salvou. Atualizando dados locais..."),window.cartData.items=[],simpleCart.each((function(e){window.cartData.items.push({id:e.get("name").replace(/\s+/g,"-").toLowerCase(),title:e.get("name"),artist:e.get("artist")||"Artista",price:e.get("price"),quantity:e.get("quantity"),image:e.get("thumb"),url:e.get("url")})})),o()})),i(),n(),window.updateWishlistUI();const c=document.getElementById("cartOverlay"),u=document.getElementById("wishlistOverlay");c&&c.addEventListener("click",window.closeCart),u&&u.addEventListener("click",window.closeWishlist),document.addEventListener("keydown",(function(e){"Escape"===e.key&&(window.closeCart(),window.closeWishlist())})),d(),console.log("‚úÖ Sistema de carrinho e favoritos inicializado.")}();
