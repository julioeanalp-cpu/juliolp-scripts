// JulioLP Cart System v1.0 - Optimized & Protected
!function(){"use strict";function t(){var t=localStorage.getItem("simpleCart_items");if(!t||"null"===t||"[]"===t)return[];try{return JSON.parse(t)}catch(t){return console.error("Erro ao carregar carrinho:",t),[]}}function e(){var e=t().length,a=document.querySelector(".cart-count");a&&(a.textContent=e,a.style.display=e>0?"flex":"none")}function a(){var e=document.getElementById("cart-dropdown"),a=document.getElementById("cart-overlay"),n=document.getElementById("cart-close");e&&a&&(e.classList.add("open"),a.classList.add("open"),document.body.style.overflow="hidden",n&&n.addEventListener("click",function(){e.classList.remove("open"),a.classList.remove("open"),document.body.style.overflow=""},{once:!0}))}function n(t){var e=t.dataset.url;if(e){var n=document.createElement("iframe");n.style.display="none",n.src=e,document.body.appendChild(n),n.onload=function(){setTimeout(function(){var t=n.contentDocument||n.contentWindow.document,o=t.querySelector(".product-title");if(o){var r=o.textContent.trim(),c=t.querySelector(".price-value");if(c){var i=c.textContent.trim();localStorage.setItem("tempProductName",r),localStorage.setItem("tempProductPrice",i);var s=t.querySelector('a[name="'+r+'"]');if(s){s.click();var l=setInterval(function(){simpleCart.items().length>0&&(clearInterval(l),document.body.removeChild(n),setTimeout(function(){e()},100))},50);setTimeout(function(){clearInterval(l),document.body.removeChild(n)},3e3)}else console.error("Link nÃ£o encontrado"),document.body.removeChild(n)}else document.body.removeChild(n)}else document.body.removeChild(n)},500)},setTimeout(function(){n.parentNode&&document.body.removeChild(n)},5e3)}else console.error("URL nÃ£o encontrada")}function o(){var t=document.getElementById("cart-items"),e=simpleCart.items();if(0===e.length)return void(t.innerHTML='<div class="empty-cart"><i class="fas fa-shopping-cart"></i><p>Carrinho vazio</p></div>');t.innerHTML=e.map(function(t,e){return'\n      <div class="cart-item" data-index="'+e+'">\n        <div class="item-info">\n          <span class="item-name">'+t.get("name")+'</span>\n          <span class="item-price">â‚¬'+parseFloat(t.get("price")).toFixed(2)+"</span>\n        </div>\n        <button class='remove-item' data-index='"+e+"'>\n          <i class='fas fa-trash'></i>\n        </button>\n      </div>\n    "}).join("");var a=simpleCart.total(),n=document.getElementById("cart-total");n&&(n.textContent="â‚¬"+a.toFixed(2)),document.querySelectorAll(".remove-item").forEach(function(t){t.addEventListener("click",function(){var t=this.dataset.index;simpleCart.items()[t].remove(),o(),e()})})}window.updateCartCount=e,window.openCart=a,window.addToCart=n,window.updateCartDisplay=o,document.addEventListener("DOMContentLoaded",function(){e();var t=document.getElementById("cart-icon");t&&t.addEventListener("click",function(t){t.preventDefault(),o(),a()});var n=document.getElementById("cart-overlay");if(n&&n.addEventListener("click",function(t){if(t.target===n){var e=document.getElementById("cart-dropdown");e.classList.remove("open"),n.classList.remove("open"),document.body.style.overflow=""}}),simpleCart){simpleCart.bind("afterAdd",function(){e(),o()}),simpleCart.bind("afterRemove",function(){e(),o()});var c=document.getElementById("checkout-btn");c&&c.addEventListener("click",function(){var t=simpleCart.items();if(0===t.length)return void alert("Carrinho vazio!");var e=t.map(function(t){return encodeURIComponent(t.get("name"))+" - â‚¬"+parseFloat(t.get("price")).toFixed(2)}).join("%0A"),a="https://wa.me/351919225483?text=";a+="ðŸ›’ *PEDIDO JULIOLP.PT*%0A%0A",a+=e,a+="%0A%0AðŸ’° *Total: â‚¬"+simpleCart.total().toFixed(2)+"*%0A%0A",a+="Nome:%0A",a+="Morada:%0A",a+="Telefone:%0A",window.open(a,"_blank")})}document.querySelectorAll(".btn-add-cart").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),n(this)})})})}();
